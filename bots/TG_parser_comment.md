–î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –µ—Å–ª–∏:

–ö–∞–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—É–±–ª–∏—á–Ω—ã–π (–Ω–µ—Ç –∑–∞–º–∫–∞ üîí –≤ –æ–ø–∏—Å–∞–Ω–∏–∏)

–í–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:

–£–∫–∞–∑–∞—Ç—å username –∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, @durov)

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ID –∫–∞–Ω–∞–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ -1001234567890

–ù–æ –µ—Å—Ç—å –Ω—é–∞–Ω—Å—ã:

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª

–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–∞—Ä—ã—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–î–∞—Ç—å –ø—Ä–∞–≤–∞:

–ú–∏–Ω–∏–º—É–º: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π"

–î–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è–º–∏"

–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –±–æ—Ç–∞
PHP-–∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

php
$response = file_get_contents("https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/getChatMember?chat_id=@username_–∫–∞–Ω–∞–ª–∞&user_id=ID_–±–æ—Ç–∞");

$data = json_decode($response, true);
if ($data['ok'] && $data['result']['status'] != 'left') {
    echo "–ë–æ—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É";
} else {
    echo "–ë–æ—Ç –ù–ï –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞!";
}
–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
–î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:

php
// –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å @username
$chat_id = '@bbc_news'; 
–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –≤–∏–¥–∏—Ç –∫–∞–Ω–∞–ª:

php
// –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª
$add_url = "https://t.me/–≤–∞—à_–±–æ—Ç?startchannel=@username_–∫–∞–Ω–∞–ª–∞&admin=post_messages";
echo "–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É: $add_url";
–î–ª—è supergroup (—á–∞—â–µ –≤—Å–µ–≥–æ):

php
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ID –≤ —Ñ–æ—Ä–º–∞—Ç–µ -100...
$chat_id = '-1001234567890';
–í–∞–∂–Ω–æ: –î–∞–∂–µ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤, –µ—Å–ª–∏ –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –æ–±—ã—á–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

–ü–æ–¥–æ–∂–¥–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ getChatMember (–∫–æ–¥ –≤—ã—à–µ)


### –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞

–û—Ç–ª–∏—á–Ω—ã–π –ø–ª–∞–Ω! –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –í–æ—Ç –¥–µ—Ç–∞–ª–∏ –ø–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º –∏ –ø–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram Bot API (2024)
–û–±—â–∏–µ –ª–∏–º–∏—Ç—ã: ~30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É –¥–ª—è –±–æ—Ç–∞

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è getDiscussionMessages: ~20 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏: 1-2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

–ü–æ—à–∞–≥–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
1. –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
–ù–∞–ø–∏—à–∏—Ç–µ @BotFather –≤ Telegram

–ö–æ–º–∞–Ω–¥–∞ /newbot

–£–∫–∞–∂–∏—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, CommentParserBot)

–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤–∏–¥–∞ 123456789:AAFm2eJZx...

2. PHP-–∫–æ–¥ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
php
<?php
// config.php - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
define('BOT_TOKEN', '–í–ê–®_–¢–û–ö–ï–ù');
define('CHANNEL', '@babyshark4'); // –∏–ª–∏ ID –∫–∞–Ω–∞–ª–∞
define('POST_ID', 13402);
define('OUTPUT_FILE', 'comments.txt');

// functions.php - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function telegramRequest($method, $params = []) {
    $url = "https://api.telegram.org/bot".BOT_TOKEN."/$method";
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $params);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_TIMEOUT, 10);
    
    $response = curl_exec($ch);
    if(curl_errno($ch)) {
        file_put_contents('error.log', curl_error($ch), FILE_APPEND);
    }
    curl_close($ch);
    
    return json_decode($response, true);
}

function saveComment($data) {
    $output = sprintf(
        "[%s] @%s (%s): %s\n",
        date('Y-m-d H:i:s', $data['date']),
        $data['user']['username'] ?? 'no_username',
        $data['user']['id'],
        str_replace("\n", " ", $data['text'])
    );
    
    file_put_contents(OUTPUT_FILE, $output, FILE_APPEND);
    echo $output; // –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
}

// main.php - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
$offset = 0;
$processed = 0;
$limit_per_minute = 20; // –õ–∏–º–∏—Ç Telegram
$start_time = time();

while (true) {
    $response = telegramRequest('getDiscussionMessages', [
        'chat_id' => CHANNEL,
        'message_id' => POST_ID,
        'offset' => $offset,
        'limit' => 100
    ]);
    
    if (!$response['ok'] || empty($response['result'])) {
        file_put_contents('error.log', "–û—à–∏–±–∫–∞ –∏–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö: ".print_r($response, true), FILE_APPEND);
        break;
    }
    
    foreach ($response['result'] as $message) {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç
        if ($message['message_id'] == POST_ID) continue;
        
        saveComment([
            'date' => $message['date'],
            'user' => $message['from'],
            'text' => $message['text'] ?? '[–º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç]'
        ]);
        
        $processed++;
    }
    
    $offset += count($response['result']);
    
    // –°–æ–±–ª—é–¥–∞–µ–º –ª–∏–º–∏—Ç—ã API
    if ($processed >= $limit_per_minute) {
        $elapsed = time() - $start_time;
        if ($elapsed < 60) {
            sleep(60 - $elapsed); // –ñ–¥–µ–º –¥–æ –∫–æ–Ω—Ü–∞ –º–∏–Ω—É—Ç—ã
        }
        $processed = 0;
        $start_time = time();
    }
    
    // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    usleep(500000); // 0.5 —Å–µ–∫—É–Ω–¥—ã
}
3. –ó–∞–ø—É—Å–∫ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

PHP 7.4+

–í–∫–ª—é—á–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ cURL

–î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –¥–ª—è –∑–∞–ø–∏—Å–∏

–ó–∞–ø—É—Å–∫:

bash
php main.php
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç:

–ü–æ–ª—É—á–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–∞—á–∫–∞–º–∏ –ø–æ 100 —à—Ç—É–∫

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ: [–¥–∞—Ç–∞] @username (ID): —Ç–µ–∫—Å—Ç

–°–æ–±–ª—é–¥–∞–µ—Ç –ª–∏–º–∏—Ç—ã API (–Ω–µ –±–æ–ª–µ–µ 20 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)

–ü–∏—à–µ—Ç –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ error.log

4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
–î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –¥–æ–±–∞–≤—å—Ç–µ:

–û–±—Ä–∞–±–æ—Ç–∫—É –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞:

php
if (isset($message['photo'])) {
    $text = '[–§–æ—Ç–æ] '.($message['caption'] ?? '');
}
–ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

php
$text = preg_replace('/<[^>]+>/', '', $message['text']); // –£–¥–∞–ª—è–µ–º HTML-—Ç–µ–≥–∏
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã CLI:

php
if ($argc > 1) {
    define('CHANNEL', $argv[1]);
    define('POST_ID', $argv[2]);
}
–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!


*** –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å  ID –±–æ—Ç–∞:
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–ø–æ–¥—Å—Ç–∞–≤–∏–≤ —Å–≤–æ–π —Ç–æ–∫–µ–Ω):

https://api.telegram.org/bot7337016333:AAHh_MoIJ9mwBE39k4Pggz8eQScG3-l5UgA/getMe
–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å ID:

–í–ê–®_–¢–û–ö–ï–ù - 7337016333:AAHh_MoIJ9mwBE39k4Pggz8eQScG3-l5UgA
"id":7337016333

{"ok":true,"result":{
	"id":7337016333,
	"is_bot":true,"first_name":"BShParsComm","username":"BShParsComm_bot","can_join_groups":true,"can_read_all_group_messages":false,"supports_inline_queries":false,"can_connect_to_business":false,"has_main_web_app":false}}